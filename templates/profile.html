<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studify - My Profile</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Konkhmer+Sleokchher&family=Lao+Muang+Khong&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: #abd1f4;
            min-height: 105vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 1251px;
            min-height: 700px;
            background: #EBF6FF;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        /* Header */
        header {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            background: white;
            border-bottom: 1px solid #f3f4f6;
            margin: -2rem -2rem 2rem -2rem;
            width: calc(100% + 4rem);
            border-radius: 15px 15px 0 0;
        }

        .logo-section {
            display: flex;
            align-items: center;
            margin-left: 10px;
            margin-right: 500px;
        }

        .logo-section img {
            width: 150px;
            height: auto;
            margin-bottom: -30px;
        }

        .logo-section h1 {
            color: #10203a;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 2.5rem;
            margin-right: 70px;
            font-weight: 650;
            margin-left: -30px;
            margin-bottom: -30px;
        }

        nav {
            display: flex;
            gap: 3rem;
            align-items: center;
            margin-bottom: -30px;
        }

        nav a {
            text-decoration: none;
            color: #000;
            font-family: 'Konkhmer Sleokchher', sans-serif;
            font-size: 1.4rem;
            font-weight: 400;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #2563eb;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-menu-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Main Content */
        main {
            padding: 2rem;
            position: relative;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        /* Profile Section */
        .profile-section h2 {
            color: #0a2139;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 2.8rem;
            font-weight: 400;
            margin-bottom: 2rem;
            margin-left: 40px;
            margin-top: -20px;
        }

        .profile-card {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .avatar-wrapper {
            position: relative;
        }

        .avatar {
            width: 159px;
            height: 156px;
            border-radius: 50%;
            background: #ebf6ff;
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
            min-width: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .profile-info h3 {
            color: #0a2139;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 2.8rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
        }

        .profile-info p {
            color: rgba(0, 0, 0, 0.6);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .btn-edit {
            background: #4a7fb8;
            color: white;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 1.25rem;
            padding: 0.6rem 2rem;
            border: none;
            border-radius: 20px;
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.25);
            cursor: pointer;
            transition: background 0.3s;
            width: fit-content;
            margin-top: 10px;
        }

        .btn-edit:hover {
            background: #3d6a9a;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¹Ù†Ø¯ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .edit-input {
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 1.3rem;
            padding: 5px 10px;
            border: 2px solid #4a7fb8;
            border-radius: 10px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 10px;
            color: #10203a;
            outline: none;
            background: rgba(255, 255, 255, 0.9);
        }

        /* Total Learning Hours Card */
        .hours-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.25);
            padding: 2rem;
        }

        .hours-card h3 {
            color: black;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 2.2rem;
            font-weight: 400;
            margin-bottom: 1rem;
        }

        .hours-value {
            color: black;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 2.2rem;
            font-weight: 400;
            margin-bottom: 1.5rem;
        }

        /* Progress Bar */
        .progress-container {
            position: relative;
            width: 100%;
            height: 15px;
            background: #e5e7eb;
            border-radius: 20px;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: #4cd4d0;
            border-radius: 20px;
            transition: width 0.3s;
        }

        .hours-text {
            color: rgba(0, 0, 0, 0.37);
            font-size: 1.25rem;
            text-align: center;
        }

        /* Bottom Grid */
        .bottom-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

       /* ğŸŸ¢ Ø§Ù„ÙƒØ§Ø±ÙˆØ³ÙŠÙ„ ÙˆØªÙ†Ø³ÙŠÙ‚ 3 Ù…ÙˆØ§Ø¯ */
        .bottom-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 2rem; align-items: start; }
        .carousel-wrapper { display: flex; align-items: center; gap: 10px; width: 100%; position: relative; }
        
        .carousel-container {
            display: flex; gap: 20px; overflow: hidden; width: 100%; padding: 10px;
            scroll-behavior: smooth;
        }

        .progress-card {
            background: white; border-radius: 25px; padding: 20px;
            min-width: calc((100% - 40px) / 3); /* Ø¹Ø±Ø¶ ÙŠØ¶Ù…Ù† Ø¸Ù‡ÙˆØ± 3 ÙƒØ±ÙˆØª */
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }

        .progress-card h4 { font-family: 'Inter'; font-weight: 800; margin-bottom: 15px; color: #10203a; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© SVG */
        .circle-box { position: relative; width: 100px; height: 100px; margin-bottom: 15px; }
        svg { transform: rotate(-90deg); }
        .circle-bg { fill: none; stroke: #f1f1f1; stroke-width: 8; }
        .circle-progress { fill: none; stroke: #4cd4d0; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1s; }
        
        .tasks-count { color: #ccc; font-weight: 600; font-size: 0.9rem; margin-top: 5px; }

        .nav-btn {
            width: 45px; height: 45px; border-radius: 50%; background: white;
            border: none; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center; z-index: 10;
        }
        /* Buttons */
        .carousel-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.25);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            flex-shrink: 0;
            z-index: 10;
        }

        .carousel-btn:hover {
            background: #f9fafb;
        }

        /* Reward Section */
        .reward-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.25);
            padding: 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .reward-icon {
            position: relative;
            min-width: 110px;
            width: 110px;
            height: 110px;
        }

        .reward-text h3 {
            color: black;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 1.25rem;
            font-weight: 400;
            margin-bottom: 0.25rem;
        }

        .reward-text p {
            color: black;
            font-family: 'Konkhmer Sleokchher', serif;
            font-size: 2.2rem;
            font-weight: 400;
        }

        /* Decorative Images */
        .deco-image {
            position: absolute;
            opacity: 0.5;
        }

        .deco-image.left {
            left: 1.5rem;
            top: 8rem;
            width: 148px;
            height: 65px;
        }

        .deco-image.bottom-left {
            left: 340px;
            bottom: 5rem;
            width: 187px;
            height: 82px;
        }

        .deco-image.top-left {
            left: 681px;
            top: 0;
            width: 187px;
            height: 82px;
        }

        .deco-image.right {
            right: 2rem;
            top: 13rem;
            width: 187px;
            height: 82px;
        }

        /* Responsive */
        @keyframes fadeInAnimation {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            opacity: 0;
            animation: fadeInAnimation 1.5s ease-out forwards;
        }

        @media (max-width: 1024px) {

            .content-grid,
            .bottom-grid {
                grid-template-columns: 1fr;
            }

            nav {
                gap: 1.5rem;
            }

            .deco-image {
                display: none;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 0 1rem;
                height: auto;
                min-height: 134px;
            }

            .logo-section h1 {
                font-size: 1.5rem;
            }

            nav {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            main {
                padding: 1rem;
            }

            .profile-card {
                flex-direction: column;
                align-items: center;
            }

            .profile-info {
                text-align: center;
            }

            .reward-card {
                flex-direction: column;
                text-align: center;
            }

            .progress-card {
                min-width: 100%;
                flex: 0 0 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo-section">
                <img src="https://api.builder.io/api/v1/image/assets/TEMP/a972516383bf9672b4c04259e76273dcddd61507?width=328"
                    alt="Studify logo">
                <h1>studify</h1>
            </div>
            <nav>
                <a href="/dashboard-page">Home</a> <a href="/friends-page">Friends</a> <a href="/auth/logout">Log out</a>
            </nav>
            <button class="mobile-menu-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
            <div class="header-blob"></div>
        </header>

        <main>
            <img class="deco-image left"
                src="https://api.builder.io/api/v1/image/assets/TEMP/24375f52f9e1b8b805b0963c3072fcbb6a9bb0df?width=296"
                alt="">
            <img class="deco-image bottom-left"
                src="https://api.builder.io/api/v1/image/assets/TEMP/fa793776abd3adf2301513f8cfb90a229732362f?width=374"
                alt="">
            <img class="deco-image top-left"
                src="https://api.builder.io/api/v1/image/assets/TEMP/fa793776abd3adf2301513f8cfb90a229732362f?width=374"
                alt="">
            <img class="deco-image right"
                src="https://api.builder.io/api/v1/image/assets/TEMP/e847a0dd2b30751e0856b81ae858e79a43d5e4d1?width=374"
                alt="">

            <div class="content-grid">
                <div class="profile-section">
                    <h2>My Profile</h2>
                    <div class="profile-card">
                        <div class="avatar-wrapper">
                            <div class="avatar">
                                <img src="https://api.builder.io/api/v1/image/assets/TEMP/14b992f93b6150097c71e1c5dd691af6b6bee56e?width=318"
                                    alt="Profile avatar">
                            </div>
                        </div>
                        <div class="profile-info">
                            <h3 id="profileName">Name Of Account</h3>
                            <p id="profileEmail">email@address.com</p>

                            <button class="btn-edit" id="editBtn">Edit Profile</button>
                        </div>
                    </div>
                </div>

                <div class="hours-card">
                    <h3>Total Learning Hours</h3>
                    <p class="hours-value">0 Hours</p>
                    <div class="progress-container">
                        <div class="progress-fill"></div>
                    </div>
                    <p class="hours-text">Next Reward at 200 Hours</p>
                </div>
            </div>

            <div class="bottom-grid">
                <div class="progress-carousel">
                    <button class="carousel-btn" id="btnLeft">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                            </path>
                        </svg>
                    </button>

                    <div class="carousel-scroll" id="carousel">
                    </div>

                    <button class="carousel-btn" id="btnRight">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                            </path>
                        </svg>
                    </button>
                </div>

                <div class="reward-card">
                    <div class="reward-icon">
                        <svg viewBox="0 0 125 118" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M59.2941 2.06119C60.1996 -0.687026 64.0872 -0.687034 64.9927 2.06118L77.6293 40.4123C78.0346 41.6424 79.1835 42.4735 80.4786 42.4735H121.281C124.197 42.4735 125.399 46.2137 123.028 47.9122L90.0909 71.5103C89.0247 72.2741 88.5784 73.6421 88.9888 74.8878L101.587 113.122C102.495 115.878 99.3496 118.19 96.9903 116.499L63.8906 92.7851C62.8461 92.0367 61.4408 92.0367 60.3962 92.7851L27.2966 116.499C24.9373 118.19 21.7918 115.878 22.7001 113.122L35.298 74.8878C35.7085 73.6421 35.2621 72.2741 34.1959 71.5103L1.25853 47.9122C-1.11215 46.2137 0.0894127 42.4735 3.00573 42.4735H43.8083C45.1034 42.4735 46.2523 41.6424 46.6576 40.4123L59.2941 2.06119Z"
                                fill="#E5982E" />
                            <path
                                d="M55.765 1.38194C56.3637 -0.460681 58.9705 -0.460687 59.5692 1.38193L71.8115 39.0598C72.0792 39.8838 72.8472 40.4417 73.7136 40.4417H113.33C115.268 40.4417 116.073 42.921 114.506 44.0598L82.4553 67.3459C81.7543 67.8552 81.461 68.758 81.7288 69.582L93.971 107.26C94.5697 109.102 92.4608 110.635 90.8934 109.496L58.8427 86.2097C58.1417 85.7004 57.1925 85.7004 56.4915 86.2097L24.4409 109.496C22.8734 110.635 20.7645 109.102 21.3632 107.26L33.6055 69.582C33.8732 68.758 33.5799 67.8552 32.8789 67.3459L0.828241 44.0598C-0.739186 42.921 0.0663619 40.4417 2.00381 40.4417H41.6206C42.4871 40.4417 43.255 39.8838 43.5227 39.0598L55.765 1.38194Z"
                                fill="#F9C440" />
                        </svg>
                    </div>
                    <div class="reward-text">
                        <h3>Reward Points Earned</h3>
                        <p id="pointsDisplay">0</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

  <script>
    // --------------------------------------------------------
    // â­ 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (API Endpoints)
    // --------------------------------------------------------
    // Ø±Ø§Ø¨Ø· Azure Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    const BASE_API_URL = 'https://studify-dye7gqa7hfchgzdk.italynorth-01.azurewebsites.net';
    
    // Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© Ø¬Ù„Ø¨/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Ù…Ø³Ø§Ø± Ø§Ù„Ù€ Blueprint Ù‡Ùˆ /profile)
    const PROFILE_API_URL = `${BASE_API_URL}/profile`;
    
    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const profileNameElement = document.getElementById('profileName');
    const profileEmailElement = document.getElementById('profileEmail');
    const profilePasswordSpan = document.getElementById('profilePassword');
    const passwordLabelContainer = document.getElementById('passwordLabel');
    const editBtn = document.getElementById('editBtn');
    const hoursValueElement = document.querySelector('.hours-value');
    const progressFillElement = document.querySelector('.progress-fill');
    const hoursTextElement = document.querySelector('.hours-text');
    const pointsDisplayElement = document.getElementById('pointsDisplay');
    const carousel = document.getElementById('carousel');
    const CIRCUMFERENCE = 251.2; 
    
    let isEditing = false; 

    function validatePassword(password) {
        if (!password) {
            return null; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø·Ø£ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºØ§Ù‹ (Ù„Ø£Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        }
        if (password.length < 8) {
            return "Password must be at least 8 characters long.";
        }
        if (!/[A-Z]/.test(password)) {
            return "Password must contain at least one uppercase letter.";
        }
        if (!/\d/.test(password)) {
            return "Password must contain at least one number.";
        }
        return null; 
    }

    // --------------------------------------------------------
    // â­ 2. Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… (API Calls)
    // --------------------------------------------------------

    // A. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (GET /profile/)
    async function fetchProfileData() {
        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ '/' Ù„Ù„Ù€ Blueprint Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const response = await fetch(`${PROFILE_API_URL}/`); 

            if (response.status === 401) {
                // ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                window.location.href = 'index.html'; 
                return;
            }
            if (!response.ok) {
                throw new Error(`Failed to fetch profile data. Status: ${response.status}`);
            }

            const data = await response.json();

            
            // ğŸ‘‡ğŸ‘‡ğŸ‘‡ Ø¶Ø¹ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ğŸ‘‡ğŸ‘‡ğŸ‘‡
            console.log("âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØµÙ„Øª Ø¨Ù†Ø¬Ø§Ø­:", data);


            
            // 2.1. ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            profileNameElement.innerText = data.username || 'N/A';
            profileEmailElement.innerText = data.email || 'N/A';
            
            // 2.2. ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ù†Ù‚Ø§Ø· (Ù†ÙØªØ±Ø¶ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ£ØªÙŠ Ù…Ù† API Ø¢Ø®Ø± Ø£Ùˆ ØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù‡Ù†Ø§)
            // Ø¨Ù…Ø§ Ø£Ù† ÙƒÙˆØ¯ Ø§Ù„Ù€ Flask Profile Blueprint Ø£Ø±Ø³Ù„ ÙÙ‚Ø· (username, email, points)ØŒ Ø³Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„ÙŠÙ‡.
            
            const totalHours = data.total_hours_studied || 0; // Ù‚ÙŠÙ…Ø© ÙˆÙ‡Ù…ÙŠØ© Ù…Ø¤Ù‚ØªØ© Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ API
            const totalPoints = data.points || 0;
            
            updateHoursDisplay(totalHours);
            pointsDisplayElement.innerText = totalPoints;

            // 2.3. ØªØ­Ø¯ÙŠØ« ÙƒØ±ÙˆØª Ø§Ù„ØªÙ‚Ø¯Ù… (Ù†ÙØªØ±Ø¶ Ø£Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ø§ ØªØ£ØªÙŠ Ù…Ù† API Ø¢Ø®Ø± Ø£Ùˆ ØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù‡Ù†Ø§)
            renderProgressCards(data.subjects || [] ); // ÙŠØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ subjects ÙÙŠ Ø§Ù„Ù€ API Ø§Ù„Ø­Ø§Ù„ÙŠ

        } catch (error) {
            console.error('Error loading profile data:', error);
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù‡Ù†Ø§
        }
    }
      

     // 2. Ø¯Ø§Ù„Ø© Ø±Ø³Ù… ÙƒØ±ÙˆØª Ø§Ù„Ù…ÙˆØ§Ø¯ (Ø§Ù„Ø¯ÙˆØ§Ø¦Ø±)
    function renderSubjects(subjects) {
            carousel.innerHTML = '';
            if (subjects.length === 0) {
                carousel.innerHTML = '<p style="color:#888; width:100%; text-align:center;">No subjects yet.</p>';
                return;
            }

            subjects.forEach(sub => {
                const percent = sub.progress_percentage || 0;
                const radius = 40;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percent / 100) * circumference;

                const card = document.createElement('div');
                card.className = 'progress-card';
                card.innerHTML = `
                    <h4>${sub.name}</h4>
                    <div class="circle-box">
                        <svg width="100" height="100">
                            <circle class="circle-bg" cx="50" cy="50" r="${radius}"></circle>
                            <circle class="circle-progress" cx="50" cy="50" r="${radius}" 
                                    stroke-dasharray="${circumference}" 
                                    stroke-dashoffset="${offset}"></circle>
                        </svg>
                    </div>
                    <p class="tasks-count">${sub.progress_percentage}% Complete</p>
                `;
                carousel.appendChild(card);
            });
        }

        // ğŸŸ¢ ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ø±ÙˆØ³ÙŠÙ„ (Ù…Ø§Ø¯Ø© Ù…Ø§Ø¯Ø©)
        document.getElementById('goRight').addEventListener('click', () => {
            const cardWidth = carousel.querySelector('.progress-card').offsetWidth + 20;
            carousel.scrollBy({ left: cardWidth, behavior: 'smooth' });
        });

        document.getElementById('goLeft').addEventListener('click', () => {
            const cardWidth = carousel.querySelector('.progress-card').offsetWidth + 20;
            carousel.scrollBy({ left: -cardWidth, behavior: 'smooth' });
        });
      
    // B. Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ùˆ/Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (PUT /profile/)
    async function updateProfile(newUsername, newPassword) {
        const updateData = {};
        if (newUsername) updateData.username = newUsername;
        if (newPassword) updateData.password = newPassword;

        if (Object.keys(updateData).length === 0) {
            alert("No changes to save.");
            revertToViewMode();
            return;
        }

        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© PUT Ù„Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø­Ø¯Ø¯ ÙÙŠ Ø§Ù„Ù€ Flask Blueprint
            const response = await fetch(`${PROFILE_API_URL}/`, {
                method: 'PUT', 
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updateData)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to update profile');
            }

            alert("Profile updated successfully!");
            revertToViewMode();
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
            await fetchProfileData();

        } catch (error) {
            console.error('Error updating profile:', error);
            alert(`Error updating profile: ${error.message}`);
        }
    }

    // --------------------------------------------------------
    // 3. Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø³Ù… ÙˆØ¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… (Render & Logic)
    // --------------------------------------------------------

    function updateHoursDisplay(totalHours) {
        const goalHours = 200;
        const hoursDisplay = totalHours.toFixed(1);
        
        let progressPercentage = (totalHours / goalHours) * 100;
        if (progressPercentage > 100) progressPercentage = 100;

        hoursValueElement.innerText = `${hoursDisplay} Hours`;
        progressFillElement.style.width = `${progressPercentage}%`;
        hoursTextElement.innerText = `Next Reward at ${goalHours} Hours`;
    }

    // --------------------------------------------------------
    // 4. Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­ÙØ¸ (Logic)
    // --------------------------------------------------------
    editBtn.addEventListener('click', function () {
        if (!isEditing) {
            // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const currentName = profileNameElement.innerText;
            
            profileNameElement.innerHTML = `<input type="text" class="edit-input" id="nameInput" value="${currentName}">`;
            profileEmailElement.style.display = 'none';


            // âœ… Ø§Ù„ØªØµØ­ÙŠØ­: Ù†Ø³ØªØ®Ø¯Ù… Ø¹Ù†ØµØ± button Ø§Ù„Ø£Ø¨ Ù„ÙˆØ¶Ø¹ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¨Ù„Ù‡
           const profileInfoContainer = editBtn.parentElement; 
    
            // âŒ ÙƒØ§Ù†: passwordLabelContainer.innerHTML = ...
            // âœ… ÙŠØµØ¨Ø­: Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ Ù…Ø¤Ù‚Øª Ù„Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
           const passwordInputsHTML = `
               <input type="password" class="edit-input" id="passwordInput" placeholder="New Password">
               <input type="password" class="edit-input" id="confirmPasswordInput" placeholder="Confirm Password">
               <div id="passwordError" style="color: #ff4d4d; font-size: 0.9rem; font-weight: normal; margin-top: 5px;"></div>
                 `;

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø¨Ù„ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            editBtn.insertAdjacentHTML('beforebegin', passwordInputsHTML);

            
            editBtn.innerText = "Save Changes";
            editBtn.style.background = "#34BDAD";
            isEditing = true;
        } else {
            // ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙØ¸
            const nameInput = document.getElementById('nameInput');
            const passwordInput = document.getElementById('passwordInput');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const errorDiv = document.getElementById('passwordError');

            const newUsername = nameInput.value;
            let newPassword = null;

            // ğŸš¨ [Ø§Ù„ØªØµØ­ÙŠØ­ 1]: Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹
            errorDiv.innerText = ''; 
            passwordInput.classList.remove('input-error');
            confirmPasswordInput.classList.remove('input-error');

            // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡Ø§)
            if (passwordInput && passwordInput.value) {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                // ğŸŸ¢ [Ø§Ù„ØªØµØ­ÙŠØ­ 2]: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙˆØ©
                const strengthError = validatePassword(password);
                if (strengthError) {
                    errorDiv.innerText = `Error: ${strengthError}`;
                    passwordInput.classList.add('input-error');
                    passwordInput.focus();
                    return; 
                }
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (passwordInput && passwordInput.value) {
                if (passwordInput.value !== confirmPasswordInput.value) {
                    errorDiv.innerText = "Passwords do not match.";
                    passwordInput.focus();
                    return; 
                }
                newPassword = passwordInput.value;
            }
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
            updateProfile(newUsername, newPassword);
        }
        }
    });


    // --------------------------------------------------------
    // 5. ÙƒÙˆØ¯ ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ±ÙˆØª (Carousel)
    // --------------------------------------------------------
    const btnLeftCarousel = document.getElementById('btnLeft');
    const btnRightCarousel = document.getElementById('btnRight');
    
    btnLeftCarousel.addEventListener('click', () => {
        const width = carousel.clientWidth;
        carousel.scrollBy({ left: -width, behavior: 'smooth' });
    });

    btnRightCarousel.addEventListener('click', () => {
        const width = carousel.clientWidth;
        carousel.scrollBy({ left: width, behavior: 'smooth' });
    });


    // --------------------------------------------------------
    // 6. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    // --------------------------------------------------------
window.addEventListener('load', fetchProfileData);

// --------------------------------------------------------
// 5. Ø¯ÙˆØ§Ù„ ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶
// --------------------------------------------------------

function revertToViewMode() {
    // 1. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ
    profileEmailElement.style.display = 'block';

    // 2. Ø¥Ø²Ø§Ù„Ø© Ø­Ù‚Ù„ Ø§Ù„Ø§Ø³Ù… (Ø§Ù„Ù€ input) ÙˆØ¥Ø¹Ø§Ø¯Ø© ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
    const nameInput = document.getElementById('nameInput');
    if (nameInput) {
        // Ù†Ø¶Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„Ø°ÙŠ ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸)
        profileNameElement.innerText = profileNameElement.querySelector('input').value; 
    }
    
    // 3. Ø¥Ø²Ø§Ù„Ø© Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
    const passwordInput = document.getElementById('passwordInput');
    const confirmPasswordInput = document.getElementById('confirmPasswordInput');
    const errorDiv = document.getElementById('passwordError');

    if (passwordInput) passwordInput.remove();
    if (confirmPasswordInput) confirmPasswordInput.remove();
    if (errorDiv) errorDiv.remove();
    
    // 4. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    editBtn.innerText = "Edit Profile";
    editBtn.style.background = "#4a7fb8";
    isEditing = false;
}
  /*     document.getElementById('btnLeft').addEventListener('click', () => {
    carousel.scrollBy({ left: -200, behavior: 'smooth' });
});

document.getElementById('btnRight').addEventListener('click', () => {
    carousel.scrollBy({ left: 200, behavior: 'smooth' });
});*/
</script>
</body>


</html>



